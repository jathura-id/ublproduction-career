<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UBL Production Recruitment</title>

<style>

/* FIX: Tambah fallback font */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #1b1e26;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
  padding: 20px;
  box-sizing: border-box;
}

.container {
  background: #371d93;
  padding: 30px;
  border-radius: 12px;
  width: 100%;
  max-width: 420px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
}

h2 {
  text-align: center;
  margin-bottom: 20px;
  line-height: 1.4;
}

input, textarea {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border-radius: 8px;
  border: none;
  background: #1f2937;
  color: white;
  box-sizing: border-box;
  font-family: inherit;
  font-size: 14px;
  outline: none;
  transition: box-shadow 0.2s;
}

input:focus, textarea:focus, select:focus {
  box-shadow: 0 0 0 2px #f17300;
}

/* FIX: Tambah styling untuk select agar konsisten */
select {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border-radius: 8px;
  border: none;
  background: #1f2937;
  color: white;
  box-sizing: border-box;
  font-family: inherit;
  font-size: 14px;
  outline: none;
  cursor: pointer;
  appearance: none;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%239ca3af' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  transition: box-shadow 0.2s;
}

select option {
  background: #1f2937;
  color: white;
}

label {
  display: block;
  margin: 10px 0 4px;
  font-size: 13px;
  color: #9ca3af;
}

/* FIX: Checkbox alignment */
#toolsGroup label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 6px 0;
  cursor: pointer;
  color: white;
  font-size: 14px;
  padding: 4px 6px;
  border-radius: 6px;
  transition: background 0.15s;
}

#toolsGroup label:hover {
  background: #374151;
}

#toolsGroup input[type="checkbox"] {
  width: auto;
  margin: 0;
  padding: 0;
  accent-color: #f17300;
  cursor: pointer;
  flex-shrink: 0;
}

button {
  padding: 12px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  margin-top: 10px;
  width: 100%;
  font-weight: bold;
  font-family: inherit;
  font-size: 14px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  transition: opacity 0.2s, transform 0.1s;
}

button:hover:not(:disabled) {
  opacity: 0.9;
  transform: translateY(-1px);
}

button:active:not(:disabled) {
  transform: translateY(0);
}

.next { background: #f17300; color: white; }
.back { background: #374151; color: white; }
.submit { background: #16a34a; color: white; }

.step {
  display: none;
}

.step.active {
  display: block;
}

.progress {
  text-align: center;
  margin-bottom: 15px;
  color: #9ca3af;
  font-size: 14px;
}

/* Progress bar */
.progress-bar-wrap {
  background: #1f2937;
  border-radius: 100px;
  height: 5px;
  margin-bottom: 20px;
  overflow: hidden;
}

.progress-bar {
  height: 100%;
  background: #f17300;
  border-radius: 100px;
  transition: width 0.4s ease;
}

.loading {
  opacity: 0.7;
  pointer-events: none;
}

/* FIX: Tambah @keyframes spin yang hilang */
@keyframes spin {
  to { transform: rotate(360deg); }
}

.spinner {
  border: 2px solid rgba(255,255,255,0.3);
  border-top: 2px solid white;
  border-radius: 50%;
  width: 16px;
  height: 16px;
  animation: spin 1s linear infinite;
  display: inline-block;
  flex-shrink: 0;
}

/* File input styling */
.file-input-wrap {
  position: relative;
  margin: 8px 0;
}

.file-input-wrap input[type="file"] {
  opacity: 0;
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0; left: 0;
  cursor: pointer;
  padding: 0;
  margin: 0;
}

.file-input-label {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #1f2937;
  padding: 12px;
  border-radius: 8px;
  border: 1.5px dashed #374151;
  cursor: pointer;
  font-size: 13px;
  color: #9ca3af;
  transition: border-color 0.2s, background 0.2s;
}

.file-input-label:hover {
  border-color: #f17300;
  background: #263041;
}

.file-input-label.has-file {
  border-color: #16a34a;
  color: #4ade80;
}

.file-info {
  font-size: 11px;
  color: #6b7280;
  margin-top: 3px;
  margin-left: 4px;
}

/* Error message */
.field-error {
  font-size: 11px;
  color: #f87171;
  margin-top: 2px;
  margin-left: 4px;
  display: none;
}

/* Success page */
#successPage {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: #111827;
  color: white;
  justify-content: center;
  align-items: center;
  font-size: 18px;
  flex-direction: column;
  text-align: center;
  padding: 20px;
  box-sizing: border-box;
  gap: 12px;
}

.success-icon {
  font-size: 56px;
  animation: popIn 0.5s cubic-bezier(0.34,1.56,0.64,1) forwards;
}

@keyframes popIn {
  from { transform: scale(0); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}

#successPage h3 {
  font-size: 22px;
  margin: 0;
}

#successPage p {
  color: #9ca3af;
  font-size: 14px;
  margin: 0;
}

</style>
</head>

<body>

<div class="container" id="mainContainer">

  <h2>UBL Production<br>Talented Crew Registration</h2>

  <div class="progress" id="progress">Step 1 of 3</div>

  <!-- Progress bar -->
  <div class="progress-bar-wrap">
    <div class="progress-bar" id="progressBar" style="width: 33%"></div>
  </div>

  <!-- STEP 1 ‚Äî Personal Info -->
  <div class="step active" id="step-0">
    <input id="fullName" placeholder="Full Name *" type="text">
    <input id="phone" placeholder="Phone Number *" type="tel">
    <input id="yearEntry" placeholder="Year of Entry" type="text">
    <input id="organization" placeholder="Your Organization" type="text">

    <button class="next" onclick="nextStep()">Next ‚Üí</button>
  </div>

  <!-- STEP 2 ‚Äî Tools & Position -->
  <div class="step" id="step-1">

    <label>Your Tools *</label>
    <div id="toolsGroup" style="max-height:220px; overflow:auto; background:#1f2937; padding:10px; border-radius:8px;">

      <label><input type="checkbox" value="Adobe Photoshop"> Adobe Photoshop</label>
      <label><input type="checkbox" value="Adobe Illustrator"> Adobe Illustrator</label>
      <label><input type="checkbox" value="Adobe InDesign"> Adobe InDesign</label>
      <label><input type="checkbox" value="Adobe Premiere Pro"> Adobe Premiere Pro</label>
      <label><input type="checkbox" value="Adobe Lightroom"> Adobe Lightroom</label>
      <label><input type="checkbox" value="Adobe Firefly"> Adobe Firefly</label>
      <label><input type="checkbox" value="Adobe Creative Cloud"> Adobe Creative Cloud</label>
      <label><input type="checkbox" value="Canva"> Canva</label>
      <label><input type="checkbox" value="CapCut"> CapCut</label>
      <label><input type="checkbox" value="DaVinci Resolve"> DaVinci Resolve</label>
      <label><input type="checkbox" value="Filmora"> Filmora</label>
      <label><input type="checkbox" value="vMix"> vMix</label>
      <label><input type="checkbox" value="OBS Studio"> OBS Studio</label>
      <label><input type="checkbox" value="Social Stream Ninja"> Social Stream Ninja</label>
      <label>
        <input type="checkbox" id="anotherToolCheck" value="Another Tool" onchange="toggleAnotherTool()">
        Another Tool
      </label>
      <input
        type="text"
        id="anotherToolInput"
        placeholder="Write your other tool here..."
        style="display:none; margin-top:8px;">

    </div>

    <label>Desired Position *</label>
    <select id="position">
      <option value="">-- Select Position --</option>
      <option>Photography</option>
      <option>Videography</option>
      <option>Graphic Design</option>
      <option>Streaming Operation</option>
    </select>

    <button class="back" onclick="prevStep()">‚Üê Back</button>
    <button class="next" onclick="nextStep()">Next ‚Üí</button>

  </div>

  <!-- STEP 3 ‚Äî Upload -->
  <div class="step" id="step-2">

    <label>Upload CV * <span style="color:#6b7280; font-size:11px;">(PDF, DOC, DOCX ‚Äî max 5MB)</span></label>
    <div class="file-input-wrap">
      <input type="file" id="cv" accept=".pdf,.doc,.docx" onchange="handleFileChange('cv', 'cvLabel', 'cvInfo')">
      <div class="file-input-label" id="cvLabel">üìÑ Choose CV file...</div>
    </div>
    <div class="file-info" id="cvInfo"></div>

    <label>Upload Portfolio * <span style="color:#6b7280; font-size:11px;">(PDF, ZIP, JPG, PNG ‚Äî max 10MB)</span></label>
    <div class="file-input-wrap">
      <input type="file" id="portfolio" accept=".pdf,.zip,.jpg,.jpeg,.png" onchange="handleFileChange('portfolio', 'portfolioLabel', 'portfolioInfo')">
      <div class="file-input-label" id="portfolioLabel">üóÇÔ∏è Choose Portfolio file...</div>
    </div>
    <div class="file-info" id="portfolioInfo"></div>

    <button class="back" onclick="prevStep()">‚Üê Back</button>
    <button class="submit" id="submitBtn" onclick="submitForm()">Submit Application</button>

  </div>

</div>

<!-- FIX: Success page yang benar (hanya muncul kalau sukses) -->
<div id="successPage">
  <div class="success-icon">‚úÖ</div>
  <h3>Application Submitted!</h3>
  <p>Thank you for joining UBL Production.<br>We'll get back to you soon.</p>
</div>


<script>

// Request dikirim ke proxy Netlify dulu, baru diteruskan ke Google Apps Script
// Cara ini menghindari blokir firewall WiFi kampus/kantor
const SCRIPT_URL = "/.netlify/functions/submit";

let currentStep = 0;
const steps = document.querySelectorAll(".step");

function showStep() {
  steps.forEach((s, i) => {
    s.classList.toggle("active", i === currentStep);
  });
  document.getElementById("progress").innerText = `Step ${currentStep + 1} of ${steps.length}`;
  const pct = ((currentStep + 1) / steps.length) * 100;
  document.getElementById("progressBar").style.width = pct + "%";
}

function nextStep() {
  // FIX: Gunakan document.getElementById() secara eksplisit
  if (currentStep === 0) {
    const fullName = document.getElementById("fullName").value.trim();
    const phone = document.getElementById("phone").value.trim();
    if (!fullName || !phone) {
      alert("Please fill in Full Name and Phone Number.");
      return;
    }
  }

  if (currentStep === 1) {
    const checkedTools = document.querySelectorAll('#toolsGroup input[type="checkbox"]:checked').length;
    if (checkedTools === 0) {
      alert("Please select at least one tool.");
      return;
    }
    const position = document.getElementById("position").value;
    if (!position) {
      alert("Please select your desired position.");
      return;
    }
  }

  currentStep++;
  showStep();
}

function prevStep() {
  currentStep--;
  showStep();
}

function toggleAnotherTool() {
  const checkbox = document.getElementById("anotherToolCheck");
  const input = document.getElementById("anotherToolInput");
  if (checkbox.checked) {
    input.style.display = "block";
    input.focus();
  } else {
    input.style.display = "none";
    input.value = "";
  }
}

// File change handler ‚Äî tampilkan nama file & validasi ukuran
function handleFileChange(inputId, labelId, infoId) {
  const input = document.getElementById(inputId);
  const label = document.getElementById(labelId);
  const info = document.getElementById(infoId);
  const file = input.files[0];

  const maxSize = inputId === 'cv' ? 5 : 10; // MB

  if (!file) return;

  if (file.size > maxSize * 1024 * 1024) {
    alert(`File terlalu besar! Maksimal ${maxSize}MB.`);
    input.value = "";
    return;
  }

  const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
  label.textContent = "‚úÖ " + file.name;
  label.classList.add("has-file");
  info.textContent = `${sizeMB} MB`;
}

async function toBase64(file) {
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result.split(',')[1]);
  });
}

async function submitForm() {
  const cvFile = document.getElementById("cv").files[0];
  const portfolioFile = document.getElementById("portfolio").files[0];

  if (!cvFile || !portfolioFile) {
    alert("Please upload both CV and Portfolio files.");
    return;
  }

  const btn = document.getElementById("submitBtn");
  btn.innerHTML = '<div class="spinner"></div> Submitting...';
  btn.classList.add("loading");

  // Ambil tools yang dipilih
  let selectedTools = Array.from(
    document.querySelectorAll('#toolsGroup input[type="checkbox"]:checked')
  ).map(cb => cb.value);

  // Ganti "Another Tool" dengan nilai input
  const anotherToolValue = document.getElementById("anotherToolInput").value.trim();
  if (selectedTools.includes("Another Tool") && anotherToolValue) {
    selectedTools = selectedTools.filter(t => t !== "Another Tool");
    selectedTools.push(anotherToolValue);
  } else {
    selectedTools = selectedTools.filter(t => t !== "Another Tool");
  }

  const data = {
    fullName: document.getElementById("fullName").value.trim(),
    phone: document.getElementById("phone").value.trim(),
    yearEntry: document.getElementById("yearEntry").value.trim(),
    organization: document.getElementById("organization").value.trim(),
    tools: selectedTools.join(", "),
    position: document.getElementById("position").value,
    cv: {
      name: cvFile.name,
      type: cvFile.type,
      data: await toBase64(cvFile)
    },
    portfolio: {
      name: portfolioFile.name,
      type: portfolioFile.type,
      data: await toBase64(portfolioFile)
    }
  };

  try {
    // Request ke proxy Netlify (/.netlify/functions/submit)
    // Proxy yang akan meneruskan ke Google Apps Script
    const response = await fetch(SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await response.json();

    if (result.status === "success") {
      document.getElementById("mainContainer").style.display = "none";
      document.getElementById("successPage").style.display = "flex";
    } else {
      throw new Error(result.message || "Unknown error from server");
    }

  } catch (err) {
    // Kalau masih error, kemungkinan masalah jaringan bukan CORS
    alert("Submission failed. Please check your internet connection and try again.");
    btn.innerHTML = "Submit Application";
    btn.classList.remove("loading");
    console.error(err);
  }
}

</script>

</body>
</html>
